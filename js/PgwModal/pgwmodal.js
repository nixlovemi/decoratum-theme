;(function($){$.pgwModal=function(obj){var pgwModal={};var defaults={mainClassName:'pgwModal',backdropClassName:'pgwModalBackdrop',maxWidth:500,titleBar:true,closable:true,closeOnEscape:true,closeOnBackgroundClick:true,closeContent:'<span class="pm-icon"></span>',loadingContent:'Loading in progress...',errorContent:'An error has occured. Please try again in a few moments.'};if(typeof window.pgwModalObject!='undefined'){pgwModal=window.pgwModalObject;}if((typeof obj=='object')&&(!obj.pushContent)){if(!obj.url&&!obj.target&&!obj.content){throw new Error('PgwModal - There is no content to display, please provide a config parameter : "url", "target" or "content"');}pgwModal.config={};pgwModal.config=$.extend({},defaults,obj);window.pgwModalObject=pgwModal;}var create=function(){var appendBody='<div id="pgwModalBackdrop"></div>'+'<div id="pgwModal">'+'<div class="pm-container">'+'<div class="pm-body">'+'<span class="pm-close"></span>'+'<div class="pm-title"></div>'+'<div class="pm-content"></div>'+'</div>'+'</div>'+'</div>';$('body').append(appendBody);$(document).trigger('PgwModal::Create');return true;};var reset=function(){$('#pgwModal .pm-title, #pgwModal .pm-content').html('');$('#pgwModal .pm-close').html('').unbind('click');return true;};var angularCompilation=function(){angular.element('body').injector().invoke(function($compile){var scope=angular.element($('#pgwModal .pm-content')).scope();$compile($('#pgwModal .pm-content'))(scope);scope.$digest();});return true;};var pushContent=function(content){$('#pgwModal .pm-content').html(content);if(pgwModal.config.angular){angularCompilation();}reposition();$(document).trigger('PgwModal::PushContent');return true;};var reposition=function(){$('#pgwModal, #pgwModalBackdrop').show();var windowHeight=$(window).height();var modalHeight=$('#pgwModal .pm-body').height();var marginTop=Math.round((windowHeight-modalHeight)/3);if(marginTop<=0){marginTop=0;}$('#pgwModal .pm-body').css('margin-top',marginTop);return true;};var getData=function(){return pgwModal.config.modalData;};var getScrollbarWidth=function(){var container=$('<div style="width:50px;height:50px;overflow:auto"><div></div></div>').appendTo('body');var child=container.children();if(typeof child.innerWidth!='function'){return 0;}var width=child.innerWidth()-child.height(90).innerWidth();container.remove();return width;};var isOpen=function(){return $('body').hasClass('pgwModalOpen');};var close=function(){$('#pgwModal, #pgwModalBackdrop').removeClass().hide();$('body').css('padding-right','').removeClass('pgwModalOpen');reset();$(window).unbind('resize.PgwModal');$(document).unbind('keyup.PgwModal');$('#pgwModal').unbind('click.PgwModalBackdrop');try{delete window.pgwModalObject;}catch(e){window['pgwModalObject']=undefined;}$(document).trigger('PgwModal::Close');return true;};var open=function(){if($('#pgwModal').length==0){create();}else{reset();}$('#pgwModal').removeClass().addClass(pgwModal.config.mainClassName);$('#pgwModalBackdrop').removeClass().addClass(pgwModal.config.backdropClassName);if(!pgwModal.config.closable){$('#pgwModal .pm-close').html('').unbind('click').hide();}else{$('#pgwModal .pm-close').html(pgwModal.config.closeContent).click(function(){close();}).show();}if(!pgwModal.config.titleBar){$('#pgwModal .pm-title').hide();}else{$('#pgwModal .pm-title').show();}if(pgwModal.config.title){$('#pgwModal .pm-title').text(pgwModal.config.title);}if(pgwModal.config.maxWidth){$('#pgwModal .pm-body').css('max-width',pgwModal.config.maxWidth);}if(pgwModal.config.url){if(pgwModal.config.loadingContent){$('#pgwModal .pm-content').html(pgwModal.config.loadingContent);}var ajaxOptions={'url':obj.url,'success':function(data){pushContent(data);},'error':function(){$('#pgwModal .pm-content').html(pgwModal.config.errorContent);}};if(pgwModal.config.ajaxOptions){ajaxOptions=$.extend({},ajaxOptions,pgwModal.config.ajaxOptions);}$.ajax(ajaxOptions);}else if(pgwModal.config.target){pushContent($(pgwModal.config.target).html());}else if(pgwModal.config.content){pushContent(pgwModal.config.content);}if(pgwModal.config.closeOnEscape&&pgwModal.config.closable){$(document).bind('keyup.PgwModal',function(e){if(e.keyCode==27){close();}});}if(pgwModal.config.closeOnBackgroundClick&&pgwModal.config.closable){$('#pgwModal').bind('click.PgwModalBackdrop',function(e){var targetClass=$(e.target).hasClass('pm-container');var targetId=$(e.target).attr('id');if(targetClass||targetId=='pgwModal'){close();}});}$('body').addClass('pgwModalOpen');var currentScrollbarWidth=getScrollbarWidth();if(currentScrollbarWidth>0){$('body').css('padding-right',currentScrollbarWidth);}$(window).bind('resize.PgwModal',function(){reposition();});$(document).trigger('PgwModal::Open');return true;};if((typeof obj=='string')&&(obj=='close')){return close();}else if((typeof obj=='string')&&(obj=='reposition')){return reposition();}else if((typeof obj=='string')&&(obj=='getData')){return getData();}else if((typeof obj=='string')&&(obj=='isOpen')){return isOpen();}else if((typeof obj=='object')&&(obj.pushContent)){return pushContent(obj.pushContent);}else if(typeof obj=='object'){return open();}}})(window.Zepto||window.jQuery);